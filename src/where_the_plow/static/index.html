<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Where the Plow</title>
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-GWD53EX053"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "G-GWD53EX053");
        </script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/maplibre-gl@5/dist/maplibre-gl.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/nouislider@15/dist/nouislider.min.css"
        />
        <link rel="stylesheet" href="/static/style.css" />
        <script src="https://unpkg.com/maplibre-gl@5/dist/maplibre-gl.js"></script>
        <script src="https://unpkg.com/nouislider@15/dist/nouislider.min.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <button id="panel-toggle" title="Toggle info panel">&#9776;</button>
        <div id="info-panel">
            <h3>Where the Plow</h3>
            <div id="mode-toggle" class="toggle-group">
                <button id="btn-realtime" class="active">Realtime</button>
                <button id="btn-coverage">Coverage</button>
            </div>
            <div id="vehicle-count">Loading vehicles...</div>
            <div id="db-size" style="display: none"></div>
            <div id="vehicle-hint">Select a vehicle to see its trail and details</div>
            <div id="vehicle-detail">
                <span class="detail-close" id="detail-close">&times;</span>
                <div class="detail-name" id="detail-name"></div>
                <div class="detail-row" id="detail-type"></div>
                <div class="detail-row" id="detail-speed"></div>
                <div class="detail-row" id="detail-bearing"></div>
                <div class="detail-row" id="detail-updated"></div>
            </div>
            <div id="coverage-panel">
                <div class="coverage-hint">Load coverage data for a time window</div>
                <div id="time-range-presets" class="toggle-group">
                    <button data-hours="6">6h</button>
                    <button data-hours="12">12h</button>
                    <button data-hours="24" class="active">24h</button>
                    <button data-hours="date">Date</button>
                </div>
                <div id="date-picker-row">
                    <input type="date" id="coverage-date" />
                </div>
                <div id="coverage-range-label"></div>
                <div class="coverage-hint">View as route lines or activity heatmap</div>
                <div id="coverage-view-toggle" class="toggle-group">
                    <button id="btn-lines" class="active">Lines</button>
                    <button id="btn-heatmap">Heatmap</button>
                </div>
                <div class="coverage-hint">Drag the handles to narrow the visible time range</div>
                <span id="slider-label"></span>
                <div id="time-slider"></div>
                <div id="coverage-loading">Loading coverage data...</div>
            </div>
            <div id="legend">
                <div id="legend-header">
                    <div class="legend-title">Legend</div>
                    <button id="legend-toggle" title="Collapse legend">
                        &#9650;
                    </button>
                </div>
                <div id="legend-body">
                    <div id="legend-vehicles">
                        <label class="legend-row" data-types="SA PLOW TRUCK,TA PLOW TRUCK">
                            <span
                                class="legend-swatch"
                                style="background: #2563eb"
                            ></span
                            >Plow truck
                            <input type="checkbox" checked class="legend-check" />
                        </label>
                        <label class="legend-row" data-types="LOADER">
                            <span
                                class="legend-swatch"
                                style="background: #ea580c"
                            ></span
                            >Loader
                            <input type="checkbox" checked class="legend-check" />
                        </label>
                        <label class="legend-row" data-types="GRADER">
                            <span
                                class="legend-swatch"
                                style="background: #16a34a"
                            ></span
                            >Grader
                            <input type="checkbox" checked class="legend-check" />
                        </label>
                        <label class="legend-row" data-types="__OTHER__">
                            <span
                                class="legend-swatch"
                                style="background: #6b7280"
                            ></span
                            >Other
                            <input type="checkbox" checked class="legend-check" />
                        </label>
                    </div>
                    <div id="legend-heatmap" style="display: none">
                        <div class="legend-gradient"></div>
                        <div class="legend-gradient-labels">
                            <span>Low</span><span>High</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="panel-footer">
                Data from
                <a
                    href="https://map.stjohns.ca/avl/"
                    target="_blank"
                    rel="noopener"
                    >City of St. John's AVL</a
                ><br />
                <a
                    href="https://github.com/jackharrhy/where-the-plow"
                    target="_blank"
                    rel="noopener"
                    >GitHub</a
                >
                &middot;
                <a href="/docs">API Docs</a>
            </div>
        </div>
        <script src="/static/app.js"></script>
    </body>
</html>
