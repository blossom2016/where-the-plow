<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>where the plow - St. John's Snowplow Tracker</title>
        <meta
            name="description"
            content="Real-time and historical snowplow tracker for St. John's, Newfoundland. See which streets have been plowed, track vehicles live, and explore coverage history."
        />
        <meta
            name="keywords"
            content="snowplow, plow tracker, St. John's, Newfoundland, NL, snow clearing, winter, realtime, city services"
        />
        <meta name="author" content="Jack Harrhy" />
        <meta name="theme-color" content="#0f172a" />
        <link rel="canonical" href="https://plow.jackharrhy.dev" />
        <meta property="og:title" content="where the plow - St. John's Snowplow Tracker" />
        <meta
            property="og:description"
            content="Real-time and historical snowplow tracker for St. John's, Newfoundland. See which streets have been plowed, track vehicles live, and explore coverage history."
        />
        <meta
            property="og:image"
            content="https://plow.jackharrhy.dev/static/og-image.png"
        />
        <meta property="og:image:alt" content="Map of St. John's showing snowplow routes" />
        <meta property="og:url" content="https://plow.jackharrhy.dev" />
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="where the plow" />
        <meta property="og:locale" content="en_CA" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="where the plow - St. John's Snowplow Tracker" />
        <meta
            name="twitter:description"
            content="Real-time and historical snowplow tracker for St. John's, Newfoundland. See which streets have been plowed, track vehicles live, and explore coverage history."
        />
        <meta
            name="twitter:image"
            content="https://plow.jackharrhy.dev/static/og-image.png"
        />
        <meta name="twitter:image:alt" content="Map of St. John's showing snowplow routes" />
        <meta name="geo.region" content="CA-NL" />
        <meta name="geo.placename" content="St. John's" />
        <meta name="geo.position" content="47.5615;-52.7126" />
        <meta name="ICBM" content="47.5615, -52.7126" />
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå®Ô∏è</text></svg>"
        />
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-GWD53EX053"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "G-GWD53EX053");
        </script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/maplibre-gl@5/dist/maplibre-gl.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/nouislider@15/dist/nouislider.min.css"
        />
        <link rel="stylesheet" href="/static/style.css" />
        <script src="https://unpkg.com/maplibre-gl@5/dist/maplibre-gl.js"></script>
        <script src="https://unpkg.com/nouislider@15/dist/nouislider.min.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <button id="panel-toggle" title="Toggle info panel">&#9776;</button>
        <div id="info-panel">
            <h3>where the plow</h3>
            <div id="search-container">
                <div id="search-input-wrap">
                    <input
                        type="search"
                        id="address-search"
                        placeholder="Search address... (Enter)"
                        autocomplete="off"
                        enterkeyhint="search"
                    />
                    <span id="search-icon" title="Search"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="10.5" cy="10.5" r="7.5"/><line x1="16" y1="16" x2="22" y2="22"/></svg></span>
                </div>
                <div id="search-results" class="search-results-hidden"></div>
                <div id="search-attribution">Powered by <a href="https://nominatim.openstreetmap.org" target="_blank" rel="noopener">Nominatim</a> &middot; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">ODbL</a></div>
            </div>
            <div id="mode-toggle" class="toggle-group">
                <button id="btn-realtime" class="active">Realtime</button>
                <button id="btn-coverage">Coverage</button>
            </div>
            <div id="vehicle-count">Loading vehicles...</div>
            <div id="db-size" style="display: none"></div>
            <div id="vehicle-hint">
                Select a vehicle to see its trail and details
            </div>
            <div id="vehicle-detail">
                <span class="detail-close" id="detail-close">&times;</span>
                <div class="detail-name" id="detail-name"></div>
                <div class="detail-row" id="detail-type"></div>
                <div class="detail-row" id="detail-speed"></div>
                <div class="detail-row" id="detail-bearing"></div>
                <div class="detail-row" id="detail-updated"></div>
                <div class="detail-row" id="detail-source"></div>
            </div>
            <div id="coverage-panel">
                <div class="coverage-hint">
                    Load coverage data for a time window
                </div>
                <div id="time-range-presets" class="toggle-group">
                    <button data-hours="6">6h</button>
                    <button data-hours="12">12h</button>
                    <button data-hours="24" class="active">24h</button>
                    <button data-hours="date">Date</button>
                </div>
                <div id="date-picker-row">
                    <input type="date" id="coverage-date" />
                </div>
                <div id="coverage-range-label"></div>
                <div class="coverage-hint">
                    View as route lines or activity heatmap
                </div>
                <div id="coverage-view-toggle" class="toggle-group">
                    <button id="btn-lines" class="active">Lines</button>
                    <button id="btn-heatmap">Heatmap</button>
                </div>
                <div class="coverage-hint">
                    Drag the handles to narrow the visible time range
                </div>
                <span id="slider-label"></span>
                <div id="time-slider"></div>
                <div id="playback-controls">
                    <div class="playback-row">
                        <button id="btn-play" title="Play">&#9654;</button>
                        <button id="btn-stop" title="Stop" disabled>
                            &#9632;
                        </button>
                        <select id="playback-speed" title="Playback speed">
                            <option value="15" selected>15s</option>
                            <option value="30">30s</option>
                            <option value="60">1m</option>
                            <option value="300">5m</option>
                            <option value="realtime">Realtime</option>
                        </select>
                    </div>
                    <div class="playback-row">
                        <label class="playback-label">Follow:</label>
                        <select id="playback-follow" title="Follow vehicle">
                            <option value="">None</option>
                        </select>
                    </div>
                </div>
                <div id="coverage-loading">Loading coverage data...</div>
            </div>
            <div id="legend">
                <div id="legend-header">
                    <div class="legend-title">Legend</div>
                    <button id="legend-toggle" title="Collapse legend">
                        &#9650;
                    </button>
                </div>
                <div id="legend-body">
                    <div id="legend-sources"></div>
                    <div id="legend-vehicles">
                        <label
                            class="legend-row"
                            data-types="SA PLOW TRUCK,TA PLOW TRUCK"
                        >
                            <span
                                class="legend-swatch"
                                style="background: #2563eb"
                            ></span
                            >Plow truck
                            <input
                                type="checkbox"
                                checked
                                class="legend-check"
                            />
                        </label>
                        <label class="legend-row" data-types="LOADER">
                            <span
                                class="legend-swatch"
                                style="background: #ea580c"
                            ></span
                            >Loader
                            <input
                                type="checkbox"
                                checked
                                class="legend-check"
                            />
                        </label>
                        <label class="legend-row" data-types="GRADER">
                            <span
                                class="legend-swatch"
                                style="background: #16a34a"
                            ></span
                            >Grader
                            <input
                                type="checkbox"
                                checked
                                class="legend-check"
                            />
                        </label>
                        <label class="legend-row" data-types="__OTHER__">
                            <span
                                class="legend-swatch"
                                style="background: #6b7280"
                            ></span
                            >Other
                            <input
                                type="checkbox"
                                checked
                                class="legend-check"
                            />
                        </label>
                    </div>
                    <div id="legend-heatmap" style="display: none">
                        <div class="legend-gradient"></div>
                        <div class="legend-gradient-labels">
                            <span>Low</span><span>High</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="panel-footer">
                Data from
                <a
                    href="https://map.stjohns.ca/avl/"
                    target="_blank"
                    rel="noopener"
                    >St. John's</a
                >,
                <a
                    href="https://www.mountpearl.ca"
                    target="_blank"
                    rel="noopener"
                    >Mount Pearl</a
                >
                &amp;
                <a
                    href="https://gps5.aatracking.com/newfoundland/wintermaintenance.html"
                    target="_blank"
                    rel="noopener"
                    >Provincial</a
                > sources<br />
                <a
                    href="https://github.com/jackharrhy/where-the-plow"
                    target="_blank"
                    rel="noopener"
                    >GitHub</a
                >
                &middot;
                <a href="/docs">API Docs</a>
                &middot;
                <a href="#" id="btn-view-info">About</a>
                &middot;
                <a href="#" id="btn-view-changelog">Changelog</a>
            </div>
        </div>
        <!-- Welcome modal -->
        <div id="welcome-overlay">
            <div id="welcome-modal">
                <button id="welcome-close" title="Close">&times;</button>
                <h2>where the plow</h2>
                <p>
                    Snowplow activity across
                    <strong>St. John's</strong>,
                    <strong>Mount Pearl</strong>, and
                    <strong>Provincial</strong> routes in Newfoundland.
                    See which streets have been plowed, track individual
                    vehicles in realtime, and explore historical coverage.
                </p>
                <div class="welcome-section">
                    <h4>Data</h4>
                    <p>
                        Vehicle positions are polled from multiple sources
                        &mdash; the
                        <a
                            href="https://map.stjohns.ca/avl/"
                            target="_blank"
                            rel="noopener"
                            >City of St. John's AVL</a
                        >, Mount Pearl, and Provincial tracking systems &mdash;
                        and stored for historical playback.
                    </p>
                </div>
                <div class="welcome-section">
                    <h4>How to use</h4>
                    <ul>
                        <li>
                            <strong>Realtime</strong>: watch vehicles move live.
                            Click one to see its recent trail.
                        </li>
                        <li>
                            <strong>Coverage</strong>: view plowed routes over
                            the last 6/12/24 hours, or pick a date. Use the time
                            slider to scrub through the window, or hit play for
                            an animated time-lapse.
                        </li>
                        <li>
                            Use the <strong>legend checkboxes</strong> to filter
                            by data source or vehicle type.
                        </li>
                    </ul>
                </div>
                <div class="welcome-section">
                    <h4>Legend</h4>
                    <div class="welcome-legend">
                        <span
                            ><span
                                class="legend-swatch"
                                style="background: #2563eb"
                            ></span
                            >Plow truck</span
                        >
                        <span
                            ><span
                                class="legend-swatch"
                                style="background: #ea580c"
                            ></span
                            >Loader</span
                        >
                        <span
                            ><span
                                class="legend-swatch"
                                style="background: #16a34a"
                            ></span
                            >Grader</span
                        >
                        <span
                            ><span
                                class="legend-swatch"
                                style="background: #6b7280"
                            ></span
                            >Other</span
                        >
                    </div>
                </div>
                <div class="welcome-section">
                    <h4>About</h4>
                    <p>
                        Built by
                        <a
                            href="https://jackharrhy.dev"
                            target="_blank"
                            rel="noopener"
                            >Jack Harrhy</a
                        >. Source on
                        <a
                            href="https://github.com/jackharrhy/where-the-plow"
                            target="_blank"
                            rel="noopener"
                            >GitHub</a
                        >.
                    </p>
                    <button id="btn-about-changelog" class="changelog-link-btn">View Changelog</button>
                </div>

                <button id="welcome-cta" class="welcome-cta-btn">
                    I'd like to know when a plow is visiting my street!
                    <span class="cta-sub"
                        >Or maybe, I just want to know more about what you're
                        building here &amp; elsewhere.</span
                    >
                </button>

                <div id="welcome-signup" style="display: none">
                    <p class="signup-note">
                        This feature isn't built yet! But if you leave your
                        email, I'll let you know when it, and other new
                        features, are ready.
                    </p>
                    <input
                        type="email"
                        id="signup-email"
                        placeholder="you@example.com"
                        autocomplete="email"
                    />
                    <label class="signup-check-row">
                        <input type="checkbox" id="signup-projects" />
                        Let me know about other projects you launch as well
                    </label>
                    <label class="signup-check-row">
                        <input type="checkbox" id="signup-siliconharbour" />
                        <span
                            >Sign me up for local tech news from
                            <a
                                href="https://siliconharbour.dev"
                                target="_blank"
                                rel="noopener"
                                onclick="event.stopPropagation()"
                                >siliconharbour.dev</a
                            >, when that newsletter launches</span
                        >
                    </label>
                    <button
                        id="signup-note-toggle"
                        class="signup-note-toggle-btn"
                    >
                        Leave a note
                    </button>
                    <textarea
                        id="signup-note-text"
                        placeholder="Anything you'd like to share..."
                        rows="3"
                        style="display: none"
                    ></textarea>
                    <button id="signup-submit" class="welcome-cta-btn">
                        Sign me up
                    </button>
                    <div id="signup-status"></div>
                </div>

                <button id="welcome-dismiss" class="welcome-dismiss-btn">
                    Got it, show me the map
                </button>
            </div>
        </div>
        <!-- Changelog modal -->
        <div id="changelog-overlay" class="hidden">
            <div id="changelog-modal">
                <button id="changelog-close" title="Close">&times;</button>
                <h2>What's New</h2>
                <div id="changelog-content">Loading...</div>
            </div>
        </div>
        <script src="/static/app.js"></script>
    </body>
</html>
